#!/usr/bin/env python3
"""Legacy console build helper.

This repository standardizes on:
- macOS: onedir console bundle under release_console/SundayPhotoOrganizer/
- Windows: onedir console bundle under release_console/SundayPhotoOrganizer/
- Teacher-facing docs: md-only (no .txt)

Prefer using the maintained scripts under scripts/.
"""

import os
import sys
import subprocess
from pathlib import Path

def main():
    """Build console release using maintained scripts."""
    print("ğŸš€ Building console release (preferred scripts)...")

    project_root = Path(__file__).resolve().parents[2]
    os.chdir(project_root)

    mac_script = project_root / "scripts" / "build_mac_app.sh"
    win_script = project_root / "scripts" / "build_windows_console_app.ps1"

    if sys.platform == "darwin":
        if not mac_script.exists():
            print(f"âŒ Missing build script: {mac_script}")
            return False
        cmd = ["bash", str(mac_script)]
    elif sys.platform.startswith("win"):
        if not win_script.exists():
            print(f"âŒ Missing build script: {win_script}")
            return False
        cmd = [
            "powershell",
            "-ExecutionPolicy",
            "Bypass",
            "-File",
            str(win_script),
        ]
    else:
        print("âŒ Unsupported platform for packaged console release.")
        return False

    print("Command:", " ".join(cmd))
    result = subprocess.run(cmd, text=True)
    if result.returncode != 0:
        print(f"âŒ Build failed (exit={result.returncode})")
        return False

    print("âœ… Build finished.")
    print("ğŸ“¦ Output folder: release_console/SundayPhotoOrganizer/")
    print("ğŸ“– Usage (ZH): release_console/ä½¿ç”¨è¯´æ˜.md")
    print("ğŸ“– Usage (EN): release_console/USAGE_EN.md")
    return True

def create_console_guide():
    """Deprecated: docs are generated by scripts/build_mac_app.sh."""
    print("â„¹ï¸ Deprecated: use scripts/build_mac_app.sh to generate release docs (md-only).")

def create_simple_launcher():
    """Deprecated: launchers are generated by scripts/build_mac_app.sh."""
    print("â„¹ï¸ Deprecated: use scripts/build_mac_app.sh to generate launchers.")

if __name__ == "__main__":
    success = main()
    
    if success:
        print("\nğŸŠ Console release built successfully!")
        print("ğŸ“‚ release_console/ contains:")
        print("   - SundayPhotoOrganizer/ (onedir bundle)")
        print("   - ä½¿ç”¨è¯´æ˜.md / USAGE_EN.md (md-only docs)")
    else:
        print("\nâŒ æ§åˆ¶å°ç‰ˆæœ¬æ‰“åŒ…å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯")
        sys.exit(1)

    # Deprecated helpers kept for backward compatibility.
    create_simple_launcher()