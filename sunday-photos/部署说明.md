# 🎓 主日学课堂照片自动整理工具 - 部署说明（控制台版）

## 📦 发布包

✅ 本项目仅提供控制台/命令行分发，交付物在 `release_console/`：

1. **SundayPhotoOrganizer** (可执行文件，已赋予执行权限)
2. **启动工具.sh** (可执行脚本，可双击或终端运行)
3. **使用说明.txt** (控制台用户指南)

将上述三个文件保持在同一目录下即可分发给老师。

## 📂 目录与文件说明（树形）

```
sunday-photos/                 # 项目根目录（源码交付）
├── release_console/           # 打包交付目录（可执行、启动脚本、说明）
├── input/                     # 源码模式输入：student_photos/、class_photos/
│   ├── student_photos/        # 参考照示例：张三.jpg，LiSi_2.png
│   └── class_photos/          # 课堂照示例：2024-12-21/活动合影.jpg
├── output/                    # 源码模式输出：学生/日期分层结果
│   ├── 张三/2024-12-21/...    # 示例：学生/日期/照片
│   └── 未知照片/2024-12-21/...# 未匹配人脸的照片
├── logs/                      # 源码模式运行日志
├── src/                       # 源码：core/ 核心，cli/ 入口，ui/ 指导，scripts/ 辅助
├── tests/                     # 自动化测试（含打包验证、教师友好测试）
├── doc/                       # 文档（PRD、TESTING 等）
├── run.py                     # 顶层运行脚本
├── run_all_tests.py           # 全量测试脚本
└── requirements.txt           # 依赖声明

运行期自动创建（桌面）：
主日学照片整理/
├── student_photos/            # 学生参考照（示例：张三.jpg）
├── class_photos/              # 课堂照片（示例：2024-12-21/活动合影.jpg）
├── output/                    # 整理结果（示例：张三/2024-12-21/活动合影_103045.jpg）
└── logs/                      # 运行日志（可清空）
```

### 📥 input 目录示例（源码模式）
```
input/
├── student_photos/
│   ├── 张三.jpg
│   ├── 张三_2.jpg
│   └── LiSi.png
└── class_photos/
  ├── 2024-12-21/
  │   ├── 活动合影.jpg
  │   └── 游戏时间.png
  └── 2024-12-28/
    └── 小组讨论.jpg
```

### 📤 output 目录示例（整理后）
```
output/
├── 张三/
│   ├── 2024-12-21/
│   │   ├── 活动合影_103045.jpg
│   │   └── 游戏时间_104823.jpg
│   └── 2024-12-28/
│       └── 小组讨论_101010.jpg
├── 李四/
│   └── 2024-12-21/
│       └── 活动合影_103045.jpg
└── 未知照片/
  └── 2024-12-21/
    └── 模糊照片_105632.jpg
```

## 🚀 老师使用流程

### 目录结构与作用
- release_console/: 交付目录，包含可执行文件、启动脚本和使用说明。
- 主日学照片整理/（首次运行自动生成，默认在桌面）：
  - student_photos/: 学生参考照片，命名为姓名 或 姓名_序号（如 张三.jpg、张三_2.jpg）。
  - class_photos/: 课堂照片，建议按日期创建子目录（如 2024-12-21/照片.jpg）。
  - output/: 整理结果，按学生 → 日期分层，并生成报告。
  - logs/: 运行日志（可清空）。

> 重要提示：程序可能会把 class_photos 根目录的照片按日期移动到 YYYY-MM-DD/ 子目录，这是正常现象（为了增量处理与便于查找）。

### input 目录规则与示例（源码运行场景）
- 默认输入根目录：input/
- 学生参考照：放在 input/student_photos/
  - 命名格式：姓名 或 姓名_序号（序号可选，1 开始），支持中文/英文
  - 示例：张三.jpg、张三_2.jpg、LiSi.jpg
- 课堂照片：放在 input/class_photos/，建议按日期建子目录
  - 日期子目录示例：input/class_photos/2024-12-21/活动合影.jpg
  - 若不分日期，也可直接放在 class_photos/ 根目录，程序会按日期归档
- 程序输出：写入 output/，按学生 → 日期分层，并生成报告

树形示例：
```
input/
├── student_photos/
│   ├── 张三.jpg
│   ├── 张三_2.jpg
│   └── LiSi.jpg
└── class_photos/
  ├── 2024-12-21/
  │   ├── 活动合影.jpg
  │   └── 游戏时间.png
  └── 2024-12-28/
    └── 小组讨论.jpg
```

output 目录示例（学生/日期分层）：
```
output/
├── 张三/
│   ├── 2024-12-21/
│   │   ├── 活动合影_103045.jpg
│   │   └── 游戏时间_104823.jpg
│   └── 2024-12-28/
│       └── 小组讨论_101010.jpg
├── 李四/
│   └── 2024-12-21/
│       └── 活动合影_103045.jpg
└── 未知照片/
  └── 2024-12-21/
    └── 模糊照片_105632.jpg
```

### 启动方式
- **双击可执行文件**：直接双击 `SundayPhotoOrganizer` 即可运行
- **终端运行**：`./release_console/SundayPhotoOrganizer`
- **启动脚本**：双击或终端运行 `./release_console/启动工具.sh`

> 若 macOS 第一次运行被阻止，可在“系统设置 → 隐私与安全性”中选择“仍要打开”。

### 首次运行
1. 程序会在桌面创建 `主日学照片整理/` 文件夹，包含：
   ```
   主日学照片整理/
   ├── student_photos/   # 学生参考照片
   ├── class_photos/     # 课堂照片
   ├── output/           # 整理结果
   └── logs/             # 程序日志
   ```
2. 按提示将照片放入对应目录，然后重新运行可执行文件。

### 可选：调整识别准确度（tolerance）
- 桌面 `主日学照片整理/config.json` 可编辑：`face_recognition.tolerance`
  - 默认 `0.6`；数值越低越严格（更少误认，但可能漏认）
  - 建议范围：`0.45 ~ 0.75`

### 照片准备
- 参考照：`姓名_序号.jpg`（如：张三_1.jpg），放入 `student_photos/`
- 课堂照：任意 .jpg/.png，放入 `class_photos/`

### 运行与查看结果
- 每次运行会自动整理并输出到 `output/`
- 终端会显示进度、统计与提示信息

## 🛠️ 环境与权限
- 平台：macOS（控制台输出，无GUI依赖）
- 运行前已赋予执行权限，如需手动修复：
  ```bash
  chmod +x release_console/SundayPhotoOrganizer
  chmod +x release_console/启动工具.sh
  ```

## 🧪 验证
- 控制台打包验收：`tests/test_console_app.py`、`tests/test_packaged_app.py`
- 全套回归：`python run_all_tests.py`

## 🧰 开发者：本机打包与发布验收

在 macOS 上从源码生成交付物（写入 `release_console/SundayPhotoOrganizer`）：

```bash
bash scripts/build_mac_app.sh
```

发布前强校验（要求交付物存在）：

```bash
REQUIRE_PACKAGED_ARTIFACTS=1 python -m pytest -q
```

## 💡 使用提示
- 若识别不准，给每个学生多放几张清晰正面参考照
- 若终端提示找不到照片，检查目录名和文件命名格式
- 可多次运行，程序会继续整理新加入的课堂照片