# 老师使用指南（打包版 / 不需要安装 Python）

**版本**: v0.4.0  
**更新日期**: 2025-12-23

适用对象：直接双击运行发布包的老师。

本指南以"**最少操作、最少疑惑**"为目标：老师只需要记住一件事——
**把照片放进桌面自动生成的文件夹，然后再双击运行一次即可。**

---

## 🎯 三步完成照片整理

### 第一步：首次运行（自动创建目录）

**macOS**：
- 双击 `release_console/启动工具.sh`（推荐）
- 或双击 `release_console/SundayPhotoOrganizer`

**Windows**：
- 双击 `release_console/Launch_SundayPhotoOrganizer.bat`（推荐）
- 或双击 `release_console/SundayPhotoOrganizer.exe`

> **macOS安全提示**：第一次运行可能被阻止，解决方法：
> 系统设置 → 隐私与安全性 → 仍要打开

**首次运行会发生什么**：
- 程序会在桌面创建文件夹：`SundaySchoolPhotoOrganizer/`
- 并自动生成这些子文件夹：
  - `student_photos/`：学生参考照
  - `class_photos/`：课堂照片
  - `output/`：整理结果
  - `logs/`：日志（遇到问题时用）

### 第二步：放照片

**学生参考照**（必须按这个方式）：
- 位置：`Desktop/SundaySchoolPhotoOrganizer/student_photos/`
- **唯一方式**：为每个学生创建一个文件夹 `student_photos/<student_name>/...`
- 文件名随意（不需要改名）
- 示例：
  ```
  student_photos/
  ├── Alice/
  │   ├── ref_01.jpg
  │   └── ref_02.png
  └── Bob/
      └── img_0001.png
  ```

**课堂照片**：
- 位置：`Desktop/SundaySchoolPhotoOrganizer/class_photos/`
- 建议按日期建子目录：`2025-12-21/group_photo.jpg`
- 也可以直接放在根目录（程序会自动按日期整理）

### 第三步：再次运行

- 再双击运行一次（方式同第一步）
- 程序会开始识别与分类
- 整理完成后，会自动打开 `output/` 文件夹
- 查看结果和整理报告

---

## 📂 输出结果说明

整理完成后，`output/` 文件夹的结构：

```
output/
├── Alice/                      # 每个学生有自己的文件夹
│   ├── 2025-12-21/             # 按日期分类
│   │   ├── group_photo_103045.jpg
│   │   └── game_time_104823.jpg
│   └── 2025-12-28/
│       └── discussion_101010.jpg
├── Bob/
│   └── 2025-12-21/
│       └── group_photo_103045.jpg
├── unknown_photos/             # 未识别到的人脸
│   ├── Unknown_Person_1/       # 🆕 相似的未知人脸自动归组（如访客、家长）
│   │   └── 2025-12-21/
│   │       ├── visitor_a.jpg
│   │       └── visitor_b.jpg
│   └── 2025-12-21/             # 单次出现的人脸
│       └── blurry_105632.jpg
└── 20251221_143052_整理报告.txt  # 详细统计报告
```

**新功能（v0.4.0）**：未知人脸智能聚类
- 程序会自动识别相似的未知人脸（如访客、家长、新学生）
- 相似的人脸会归入 `unknown_photos/Unknown_Person_1/`、`Unknown_Person_2/` 等
- 单次出现的人脸仍在 `unknown_photos/日期/` 中
- 这样方便老师：
  - 快速找到某个访客的所有照片
  - 识别经常参与的家长
  - 为新学生补充参考照（看到 Unknown_Person_X 中照片多，可能是新学生）

---

## ⚠️ 重要提示（避免"惊吓点"）

### 照片会被移动吗？

**会！但这是正常的**：
- 程序会把 `class_photos/` 根目录的照片**按日期移动**到 `YYYY-MM-DD/` 子目录
- 这是为了增量处理与便于查找
- 原始照片不会丢失，只是换了位置

**举例**：
```
之前：class_photos/photo1.jpg
之后：class_photos/2025-12-21/photo1.jpg
```

### 需要每次放照片吗？

**不需要！第二次运行会更快**：
- 程序会记住已经处理过的照片
- 只处理新增或变更的照片
- 这叫"增量处理"，节省时间

---

## 💡 常见问题

### Q1: 程序很快结束，没有输出？
**原因**：通常是 `student_photos/` 或 `class_photos/` 里没照片

**解决**：
1. 检查 `student_photos/` 是否有学生文件夹
2. 检查 `class_photos/` 是否有照片
3. 按提示放好后再运行

### Q2: 识别不准确怎么办？
**不用调参数**！按这三步做就够：

1. **补充参考照**：
   - 给该学生补 2-3 张清晰正脸参考照
   - 要求：清晰、正脸、无遮挡、不要太小

2. **参考照质量**：
   - 尽量"只拍这个学生一个人"
   - 不要用多人合照当参考照

3. **课堂照质量**：
   - 光线充足
   - 人脸不要太小/太模糊
   - 必要时换更清晰的原图

### Q3: 什么是 Unknown_Person_X？
**这是新功能（v0.4.0）**：智能未知人脸聚类

**含义**：
- 程序自动将相似的未知人脸归在一起
- `Unknown_Person_1` = 第1组相似人脸
- `Unknown_Person_2` = 第2组相似人脸

**应用场景**：
- **访客**：家长来访多次，会自动归组
- **新学生**：还没建立参考照，临时归档
- **志愿者**：经常参与活动的志愿者

**如何处理**：
1. 查看 `Unknown_Person_X` 文件夹里的照片
2. 如果是新学生：
   - 选 2-3张清晰照片
   - 放到 `student_photos/<学生名>/` 
   - 下次运行就会识别了
3. 如果是访客/家长：可以保留或删除（看需求）

### Q4: 程序运行出错怎么办？
**需要求助时**，请提供：
1. `Desktop/SundaySchoolPhotoOrganizer/logs/` 里最新的日志文件
2. 描述问题（什么时候出错、错误提示等）

---

## 📊 理解整理报告

打开 `output/整理报告.txt`，你会看到：

```
==============================================
主日学照片整理报告
==============================================
整理时间: 2025-12-21 14:30:52

📊 统计信息
--------------
总照片数: 25 张
成功识别: 20 张
未识别: 5 张
处理耗时: 45 秒

👥 学生分布
--------------
Alice: 12 张
Bob: 8 张
Unknown_Person_1: 3 张  # 🆕 访客/家长/新学生
unknown_photos: 2 张    # 单次出现的人脸

✅ 整理完成
输出目录: .../output/
==============================================
```

---

## 🚀 进阶使用（可选）

### 如果照片很多（50+张）

程序会自动提示是否开启并行加速：

```
💡 性能提示：检测到 80 张待识别照片
   建议开启并行识别以加速处理
   预计可节省: 120秒 → 40秒
```

**如何开启**（仅适用于源码版，打包版不需要）：
- 打包版已自动优化，无需额外操作

### 如果想保留原始照片

**方法**：在整理前先备份
```
复制 class_photos/ → class_photos_backup/
```

然后运行程序整理 `class_photos/`

---

## 🎓 小贴士

1. **参考照越清晰，识别越准确**
   - 推荐：证件照、清晰自拍
   - 避免：模糊、侧脸、多人合照

2. **定期清理 logs/ 文件夹**（可选）
   - 日志会累积，占用空间
   - 可以定期删除旧日志

3. **output/ 可以直接发给家长**
   - 每个学生文件夹独立
   - 可以压缩后发送

4. **Unknown_Person_X 的妙用**
   - 快速找到访客的所有照片
   - 识别"常客"（多次出现的家长）
   - 为新学生建档（转为正式学生）

---

## 开发者备注（非老师使用）

源码/命令行入口与参数（如 `--tolerance`）属于开发与测试用途；老师默认走打包版 `SundayPhotoOrganizer` + 桌面目录模式。

如需调整高级参数（如识别阈值、并行配置），请参考：
- 配置说明：[CONFIG.md](CONFIG.md)
- 开发指南：[DeveloperGuide.md](DeveloperGuide.md)
