# 运行时健康检查与故障诊断 (Runtime Health Check)

**版本**: v0.4.0  
**更新日期**: 2026-01-02

目的：当程序运行异常时，使用本清单快速定位问题。

---

## 1. 基础环境检查

- [ ] **Work Folder 位置**: 
  - 检查控制台第一行输出的 `Work folder: ...`
  - 确认该目录可读写
  - 确认 `input/`, `output/`, `logs/` 都在该目录下

- [ ] **输入目录结构**:
  - `input/student_photos/` 下是否每个学生都有独立文件夹？
  - `input/class_photos/` 下是否有照片？

- [ ] **日志文件**:
  - `logs/` 目录下是否有最新的 `.log` 文件？
  - 打开最新日志，是否有 `ERROR` 或 `WARNING`？

---

## 2. 常见故障现象与对策

### 现象 A: 运行后什么都没发生（闪退）
- **原因**: 可能是权限问题或缺少依赖（Windows）。
- **诊断**: 
  - macOS: 打开终端，拖入可执行文件，回车运行，看报错信息。
  - Windows: 打开 CMD，拖入 .exe，回车运行。
- **对策**: 
  - 检查是否被杀毒软件拦截。
  - 检查是否缺少 VC++ 运行库。

### 现象 B: 提示“找不到 input 目录”
- **原因**: 运行路径不对（未在程序同级目录运行）。
- **对策**: 
  - 务必双击 `启动工具` 或 `.app`，不要直接在终端 `cd` 到其他地方运行。
  - 检查 `Work folder` 输出路径是否符合预期。

### 现象 C: 所有照片都归入 unknown
- **原因**: 参考照无效或阈值过高。
- **诊断**: 
  - 检查 `input/student_photos/` 下是否为空？
  - 检查日志中是否有 `加载了 0 名学生` 的提示。
- **对策**: 
  - 确保参考照是清晰正脸。
  - 确保参考照放在 `student_photos/<名字>/` 文件夹内，而不是直接放在根目录。

---

## 3. 自动化诊断（推荐）

如果上述检查无法解决问题，请运行自动化诊断脚本（如果已提供）：

```bash
# macOS / Linux
bash scripts/diagnose.sh

# Windows
# (暂无自动脚本，请手动打包 logs 文件夹)
```

---

## 4. 缓存清理（最后手段）

如果怀疑缓存损坏导致问题：

1. 删除 `output/.state/` 文件夹（这将重置增量处理状态）。
2. 删除 `logs/reference_encodings/` 文件夹（这将强制重新编码参考照）。
3. 重新运行程序。
