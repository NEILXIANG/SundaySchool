# 反向 PRD（从现有实现倒推需求）— 主日学课堂照片自动整理工具

本文档目的：
- 从当前仓库实现“反向生成”产品需求文档（PRD），用于对齐目标、边界与验收口径。
- 明确：老师端以“零参数、零配置、最少疑惑”为第一优先级；开发者端以“可测试、可打包、可发布验收”为第一优先级。

更新时间：2025-12-22

---

## 1. 背景与问题

主日学课堂会产生大量照片（多为多人合照/活动照）。老师需要将照片按学生归档，常见问题：
- 手工整理耗时，且容易漏、错、重复。
- 老师计算机基础有限，不会/不愿意使用命令行与参数。
- 一旦出错，老师不知道如何描述问题、如何求助。

本工具希望把“整理照片”变成一个可重复、低门槛的流程。

---

## 2. 产品目标（Goals）

### G1：老师端零参数闭环（核心）
- 老师不需要理解阈值/配置/命令行。
- 只需：双击运行 → 放照片 → 再双击运行 → 自动打开结果。

### G2：最少疑惑（核心）
- 文档、启动脚本、可执行文件名、控制台提示必须一致。
- 程序行为必须“可解释”：尤其是“自动按日期移动课堂照片”这种正确但容易吓到老师的行为。

### G3：可求助（核心）
- 出错时必须告诉老师：
  - 发生了什么（非技术描述）
  - 下一步怎么做（可执行动作）
  - 日志在哪里（发哪个文件）

### G4：开发者可发布（重要）
- 打包产物可生成、可验证、可严格验收。
- 日常开发/CI 测试稳定；发布前可以强校验打包产物。

---

## 3. 用户画像（Personas）

### P1：老师（非技术用户）
- 能力：下载/解压/双击、拖拽照片到文件夹、打开输出文件夹。
- 不做：命令行、参数调优、手工排障。

### P2：维护者（技术用户）
- 需要：日志、复现路径、测试覆盖、打包链路、严格验收。

---

## 4. 使用场景与用户旅程（Teacher Journeys）

### J1：首次运行（无照片）
1) 老师双击运行打包程序。
2) 程序在桌面创建工作目录结构。
3) 若缺学生照或课堂照：提示“把什么照片放到哪里”，然后退出。

### J2：再次运行（开始整理）
1) 老师将学生参考照放到 `student_photos/`。
2) 老师将课堂照放到 `class_photos/`（建议按日期子目录）。
3) 老师再次双击运行。
4) 程序整理完成后自动打开 `output/`。

### J3：识别不准（不涉及任何参数）
- 提供“三步法”排查：
  1) 给该学生补 2-3 张清晰正脸参考照（只拍该学生一个人、无遮挡、人脸不要太小）
  2) 不要用多人合照当参考照
  3) 课堂照尽量光线充足、人脸不要太小/太模糊（必要时换更清晰原图）

### J4：运行失败（可自助 + 可求助）
- 控制台显示友好错误提示，包含：原因 + 下一步 + 日志路径。

---

## 5. 功能需求（Functional Requirements）

### FR1 输入目录与命名
- 学生参考照：放在 `student_photos/`。
  - 命名：`姓名.jpg` 或 `姓名_2.jpg`（序号可选）。
- 课堂照片：放在 `class_photos/`。
  - 建议按日期子目录：`YYYY-MM-DD/照片.jpg`。

### FR2 自动创建目录（教师友好）
- 首次运行自动创建工作目录及必要子目录。
- 为关键目录生成简短说明文件（可选）。

### FR3 课堂照片按日期归档
- 若课堂照直接放在 `class_photos/` 根目录：程序可按日期推断并移动到对应日期子目录。
- 必须在欢迎信息/使用说明中明确“这是正常现象”。

### FR4 人脸识别与分类
- 从学生参考照构建识别库。
- 扫描课堂照并识别人脸。
- 匹配到学生：输出到该学生目录（通常按“学生 → 日期”分层）。
- 未匹配/无人脸/错误：输出到“unknown_photos/failed”类别（可统计、可追溯）。

### FR5 增量处理（老师无感）
- 重复运行默认只处理新增/变更的日期目录（性能关键）。

### FR6 结果展示与自动打开
- 输出统计：总数、成功、未知、失败、识别到的学生数等。
- 处理完成后自动打开 `output/`；失败则提示手动打开路径。

### FR7 日志
- 每次运行生成日志文件，保存在 `logs/`。
- 求助时只需“把最新日志发给技术支持”。

---

## 6. 非功能需求（NFR）

### NFR1 易用性
- 老师端零参数、零配置。
- 文案必须是“老师可理解”的中文提示。

### NFR2 鲁棒性
- 缺照片、空文件、格式不支持、权限问题等应有友好提示。

### NFR3 可观测性
- 日志可定位问题；错误提示包含日志目录。

### NFR4 可测试性
- pytest 全绿；关键流程（老师入口、目录创建、缺照片提示、打包验收）有测试覆盖。

### NFR5 可发布性
- 可通过打包脚本生成产物。
- 发布前可严格验收打包产物存在性/可执行性/说明文件齐全。

---

## 7. 边界条件与约束（Boundary Conditions）

- BC1 照片质量：模糊、侧脸、遮挡、光线差会降低识别率。
- BC2 同名学生：可能冲突（后续可加入“班级/昵称后缀”策略）。
- BC3 多人合照：一张照片可能匹配多个学生（需定义复制策略）。
- BC4 无人脸/小脸：归入未知类别并统计。
- BC5 macOS 安全拦截：首次运行可能被阻止，需要文档覆盖。
- BC6 文件权限/文件占用：应给出可执行的下一步。
- BC7 可选依赖与打包：依赖缺失时需可解释；打包需 best-effort 收集数据。

---

## 8. 验收标准（Acceptance Criteria）

### 老师端（必须）
- AC-T1：双击运行可创建桌面目录。
- AC-T2：缺照片时提示“放哪儿”，并退出。
- AC-T3：放齐照片后再次运行可完成整理并自动打开输出。
- AC-T4：识别不准时仅提供“三步法”，不引导调参。
- AC-T5：发生错误时提示包含“下一步动作 + 日志位置”。
- AC-T6：文档口径一致（入口名/目录名/行为说明一致）。

### 开发者端（重要）
- AC-D1：pytest 全绿。
- AC-D2：打包脚本可生成产物。
- AC-D3：严格验收模式可强制检查打包产物存在且可执行。

---

## 9. 非目标（Non-goals）

- 不提供 GUI。
- 不要求老师进行任何参数调优。
- 不做云端/在线服务。
- 不强依赖网络。

---

## 10. 文档与交付物（当前仓库对应）

- 老师指南：doc/TeacherGuide.md
- 打包版说明：release_console/使用说明.txt
- 开发与打包：doc/DeveloperGuide.md
- 测试说明：doc/TESTING.md
